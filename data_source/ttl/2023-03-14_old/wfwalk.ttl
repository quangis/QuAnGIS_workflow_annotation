# @Author(s): Eric Top
@prefix data: <https://github.com/quangis/cct/blob/master/tools/data.ttl#> .
@prefix dbo: <https://dbpedia.org/ontology/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix repo: <https://example.com/#> .
@prefix tools: <https://github.com/quangis/cct/blob/master/tools/tools.ttl#> .
@prefix wf: <http://geographicknowledge.de/vocab/Workflow.rdf#> .

repo:wfwalk a wf:Workflow ;
    wf:edge data:wfwalk_n0,
        data:wfwalk_n15,
        data:wfwalk_n17,
        data:wfwalk_n19,
        data:wfwalk_n21,
        data:wfwalk_n23,
        data:wfwalk_n25,
        data:wfwalk_n27,
        data:wfwalk_n36,
        data:wfwalk_n37,
        data:wfwalk_n38,
        data:wfwalk_n41,
        data:wfwalk_n43,
        data:wfwalk_n45,
        data:wfwalk_n47,
        data:wfwalk_n49,
        data:wfwalk_n50,
        data:wfwalk_n53,
        data:wfwalk_n56,
        data:wfwalk_n58,
        data:wfwalk_n60,
        data:wfwalk_n61,
        data:wfwalk_n63,
        data:wfwalk_n65,
        data:wfwalk_n9 ;
    wf:source data:wfwalk_households,
        data:wfwalk_streets ;
    dct:subject "" ;
    rdfs:comment "What is the walkability of Amsterdam?" ;
    dbo:abstract "." .

data:wfwalk_Amsterdam_buurt rdfs:comment "Vector polygons representing neighborhoods in Amsterdam" .

data:wfwalk_n0 wf:applicationOf tools:CopyFeatures ;
    wf:input1 data:wfwalk_Amsterdam_buurt ;
    wf:output data:wfwalk_buurten ;
    rdfs:comment "Copy vector polygons representing buurten of Amsterdam to local file" .

data:wfwalk_n15 wf:applicationOf tools:AddField ;
    wf:input1 data:wfwalk_buurten_HH_Temp ;
    wf:output data:wfwalk_buurten_HH_Temp2 ;
    rdfs:comment "Add field for household count data to an attribute in the buurten attribute table" .

data:wfwalk_n17 wf:applicationOf tools:CalculateField ;
    wf:input1 data:wfwalk_buurten_HH_Temp2 ;
    wf:output data:wfwalk_buurten_HH ;
    rdfs:comment "Copy household count data to an attribute in the buurten attribute table" .

data:wfwalk_n19 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_Amsterdam_land ;
    wf:output data:wfwalk_residential_area ;
    rdfs:comment "Select residential area in Amsterdam" .

data:wfwalk_n21 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_Amsterdam_land ;
    wf:output data:wfwalk_retail_area ;
    rdfs:comment "Select retail area in Amsterdam" .

data:wfwalk_n23 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_Amsterdam_land ;
    wf:output data:wfwalk_office_area ;
    rdfs:comment "Select office area in Amsterdam" .

data:wfwalk_n25 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_Amsterdam_land ;
    wf:output data:wfwalk_institution_area ;
    rdfs:comment "Select institution area in Amsterdam" .

data:wfwalk_n27 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_Amsterdam_land ;
    wf:output data:wfwalk_recreational_area ;
    rdfs:comment "Select recreational area in Amsterdam" .

data:wfwalk_n36 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_buurten_HH ;
    wf:input2 data:wfwalk_residential_area ;
    wf:output data:wfwalk_buurten_HH_RA ;
    rdfs:comment "Sum residential area size in each neighbourhood" .

data:wfwalk_n37 wf:applicationOf tools:AddField ;
    wf:input1 data:wfwalk_buurten_HH_RA ;
    wf:output data:wfwalk_buurten_HH_RA2 ;
    rdfs:comment "Add a residential density attribute" .

data:wfwalk_n38 wf:applicationOf tools:CalculateField ;
    wf:input1 data:wfwalk_buurten_HH_RA2 ;
    wf:output data:wfwalk_buurten_res_dens ;
    rdfs:comment "Calculate residential density" .

data:wfwalk_n41 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_retail_area ;
    wf:input2 data:wfwalk_buurten_res_dens ;
    wf:output data:wfwalk_BRdRaRe ;
    rdfs:comment "Sum retail area size in each neighbourhood" .

data:wfwalk_n43 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_office_area ;
    wf:input2 data:wfwalk_BRdRaRe ;
    wf:output data:wfwalk_BRdRaReOf ;
    rdfs:comment "Sum office area size in each neighbourhood" .

data:wfwalk_n45 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_institution_area ;
    wf:input2 data:wfwalk_BRdRaReOf ;
    wf:output data:wfwalk_BRdRaReOfIn ;
    rdfs:comment "Sum institutional area size in each neighbourhood" .

data:wfwalk_n47 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_recreational_area ;
    wf:input2 data:wfwalk_BRdRaReOfIn ;
    wf:output data:wfwalk_BRdRaReOfInRec ;
    rdfs:comment "Sum recreational area size in each neighbourhood" .

data:wfwalk_n49 wf:applicationOf tools:AddField ;
    wf:input1 data:wfwalk_BRdRaReOfInRec ;
    wf:output data:wfwalk_BRdRaReOfInRec2 ;
    rdfs:comment "Add a land use mix attribute" .

data:wfwalk_n50 wf:applicationOf tools:CalculateField ;
    wf:input1 data:wfwalk_BRdRaReOfInRec2 ;
    wf:output data:wfwalk_BRdRaReOfInRec3 ;
    rdfs:comment "Calculate a land use mix attribute" .

data:wfwalk_n53 wf:applicationOf tools:SelectLayerByAttribute ;
    wf:input1 data:wfwalk_streets ;
    wf:output data:wfwalk_true_intersection ;
    rdfs:comment "Select only true intersections (with 3 or more streets (Edge count > 2))" .

data:wfwalk_n56 wf:applicationOf tools:SummarizeWithin ;
    wf:input1 data:wfwalk_BRdRaReOfInRec3 ;
    wf:input2 data:wfwalk_true_intersection ;
    wf:output data:wfwalk_BRdRaReOfInRecInter ;
    rdfs:comment "Count the number of street intersections in each neighborhood" .

data:wfwalk_n58 wf:applicationOf tools:AddGeometryAttributes ;
    wf:input1 data:wfwalk_BRdRaReOfInRecInter ;
    wf:output data:wfwalk_BRdRaReOfInRecInter2 ;
    rdfs:comment "Calculate the area of each neighborhood" .

data:wfwalk_n60 wf:applicationOf tools:AddField ;
    wf:input1 data:wfwalk_BRdRaReOfInRecInter2 ;
    wf:output data:wfwalk_BRdRaReOfInRecInter3 ;
    rdfs:comment "Add a field for intersection density per neighborhood" .

data:wfwalk_n61 wf:applicationOf tools:CalculateField ;
    wf:input1 data:wfwalk_BRdRaReOfInRecInter3 ;
    wf:output data:wfwalk_BRdRaReOfInRecInter4 ;
    rdfs:comment "Calculate intersection density per neighborhood" .

data:wfwalk_n63 wf:applicationOf tools:AddField ;
    wf:input1 data:wfwalk_BRdRaReOfInRecInter4 ;
    wf:output data:wfwalk_BRdRaReOfInRecInter5 ;
    rdfs:comment "Add a field for the walkability index values" .

data:wfwalk_n65 wf:applicationOf tools:CalculateField ;
    wf:input1 data:wfwalk_BRdRaReOfInRecInter5 ;
    wf:output data:wfwalk_walkability ;
    rdfs:comment "Calculate the walkability index values" .

data:wfwalk_n9 wf:applicationOf tools:JoinField ;
    wf:input1 data:wfwalk_households ;
    wf:input2 data:wfwalk_buurten ;
    wf:output data:wfwalk_buurten_HH_Temp ;
    rdfs:comment "Join household count data to the buurten attribute table" .

data:wfwalk_Amsterdam_land rdfs:comment "Land use dataset of Amsterdam" .

